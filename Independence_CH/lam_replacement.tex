\section{Lambda replacements}\label{sec:lambda-replacements}

The development of the locale structure of the project was a dynamical
process. As further properties of closure of the ground $M$ were
required, we gathered the relevant instances of Separation and
Replacement into a new locale (always assuming a class model, for
added generality), and proceeded to apply them to those closure proofs.

This procedure lead to a steady grow in the number of interpretation
obligations and therefore, of formula synthesis (since the two axiom
schemes were postulated using codes for formulas). That number would
easily surpass the hundred, and the automatic tools at our disposal
for that task were rudimentary (as discussed in
Section~\ref{sec:bureaucracy-scale-factors}).

Facing this situation, we decided that we needed some sort of
\emph{compositionality} in order to obtain new instances from the ones
already proved: Having Replacement for class functions $F$ and $G$
does not entail immediately replacement under $F\circ G$ (unless you
use one further instance of Separation, and the net gain is zero). The
solution was to postulate for the relevant $F$s, instead of
replacement through $x\mapsto F(x)$, a \emph{lambda replacement}
through $x\mapsto \lb x,F(x)\rb$. The name “lambda” corresponds to the
fact that this type of replacement is equivalent to closure under
$(\lambda x\in A.\ F(x)) \defi \{ \lb x,F(x)\rb : x\in A \}$ for every
$A\in M$.

Now, a fixed set of six replacements and one separation (apart from
those in \locale{M{\uscore}basic}, which also assumes the Powerset
Axiom for the class $M$) is sufficient to obtain the lambda
replacement under $x\mapsto \lb x,F(G(x))\rb$ given those for $F$ and
$G$. To obtain compositions with binary class functions $H$, it is
enough to assume the lambda replacement
$x\mapsto \lb x,H(\mathit{fst}(x),\mathit{snd}(x)))\rb$. We summarize
the assumptions in Table~\ref{tab:m-repl-instances}.

\newcommand{\lamRepl}[2][x]{#1 \mapsto\langle #1,#2\rangle}
\begin{table}[!h]
\centering
\begin{threeparttable}
\begin{tabular}{r<{\stepcounter{LamReplCount}\theLamReplCount.} >{\hspace{1ex}}l @{\hspace{0.8em}} p{16.3em}}
  \toprule
  \multicolumn{1}{r}{No.} & Name & Instance  \\
  \midrule
  \multicolumn{3}{@{}l}{\hspace{0.3em}{\textit{{Replacement Instances}}}}\\
  & \isa{lam{\uscore}replacement{\uscore}fst} & $\lamRepl{\mathit{fst}(x)}$ \\
  & \isa{lam{\uscore}replacement{\uscore}snd} & $\lamRepl{\mathit{snd}(x)}$ \\
  & \isa{lam{\uscore}replacement{\uscore}Union} & $\lamRepl{\bigcup(x)}$ \\
  & \isa{lam{\uscore}replacement{\uscore}Image} & $\lamRepl{\mathit{fst}(x)``\mathit{snd}(x)}$ \\
  & \isa{lam{\uscore}replacement{\uscore}middle{\uscore}del} &
        $\lamRepl{\langle \mathit{fst}(\mathit{fst}(x)),\mathit{snd}(\mathit{snd}(x)) \rangle}$ \\
  & \isa{lam{\uscore}replacement{\uscore}prodRepl} &
  $x \mapsto \bigl\langle \mathit{snd}(\mathit{fst}(x)),\bigr.$
  \newline
  $\bigl.\phantom{x \mapsto \langle \mathit{snd}}\langle \mathit{fst}(\mathit{fst}(x)),\mathit{snd}(\mathit{snd}(x))\rangle \bigr\rangle$\\
  \midrule
  \multicolumn{3}{@{}l}{\hspace{0.3em}{\textit{{Separation Instances}}}}\\
  & \isa{middle{\uscore}separation} & $\mathit{snd}(\mathit{fst}(x))=\mathit{fst}(\mathit{snd}(x))$ \\
  & \isa{separation{\uscore}fst{\uscore}in{\uscore}snd} & $\mathit{fst}(\mathit{snd}(x)) \in \mathit{snd}(\mathit{snd}(x))$\\
  \bottomrule
\end{tabular}
\caption{Replacement and Separation instances of the locale \isa{M{\uscore}replacement}.}
\label{tab:m-repl-instances}
\end{threeparttable}
\end{table}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "independence_ch_isabelle"
%%% ispell-local-dictionary: "american"
%%% End:
