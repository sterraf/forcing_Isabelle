%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%          
\section{Introduction}
% no \IEEEPARstart
Zermelo-Fraenkel Set Theory ($\ZF$) has a prominent place among formal
theories; in particular, it provides a foundation for mathematics and
most of the formal toolkit used everyday by the computer scientist has
also Set Theory at its base (cf.~\cite{paulson1995set}). In this time
of mechanization of mathematics~\cite{avigad2018mechanization}, it
seems natural to ask for a mechanization of the most salient results
of Set Theory.

After G\"odel's Incompleteness Theorems, we cannot expect to have a
formal proof of the consistency of Set Theory in $\ZF$. Besides its own
consistency, there are other results which are undecided by $\ZF$: the
undecidability of Continuum Hypothesis leads to the development of
techniques for independence proofs. First G\"odel introduced the
theory of \emph{inner models}, which gives rise to his model $L$ of
the \emph{Axiom of Constructibility} \cite{godel-L} and proved the
relative consistency of the Axiom of Choice and the Generalized
Continuum Hypothesis with $\ZF$. Thirty years later Paul
J. Cohen~\cite{Cohen-CH-PNAS} devised the technique of \emph{forcing},
which is the only known way of \emph{extending} models of $\ZF$; in
particular, it can be used to prove the relative consistency of the
negation of the Continuum Hypothesis. 

In this work we address a substantial part of formalizing the proof
that given a model $M$ of $\ZF$, any \emph{generic extension} $M[G]$
given by forcing also satisfies $\ZF$. As remarked by
\citet[][p.250]{kunen2011set} \enquote{[...] in verifying that $M[G]$
  is a model for set theory, the hardest axiom to verify is
  Comprehension.}  The most important achievement of this paper is the
mechanization in Isabelle a considerable part of this result; en route
to this, we also formalized the satisfaction by $M[G]$ of
Extensionality, Foundation, Union, and Infinity. % We have already
% proved Pairing in the first report of our project
% \cite{2018arXiv180705174G}.

Our development benefited from the remarkable work done by Lawrence
Paulson \cite{paulson_2003} on the formalization of G\"odel's
constructible universe in the proof assistant \emph{Isabelle}. The
ultimate goal of our project is the formalization of forcing to
complete the mechanization of the independence of the Continuum
Hypothesis. We think that this project constitutes an interesting case
which stresses how feasible is to formally implement mathematics that
involve several levels of reasoning.

The \emph{Formal Abstract} project~\cite{hales-fabstracts} proposes
that the formalization of mathematics by writing the statements of
results and the material upon which they are based (definitions,
propositions, lemmas), but ommiting the proofs. We took a less drastic
position: since the proof that those axioms hold in generic extension
is independent of the \emph{proofs} of the ``fundamental'' theorems of
forcing, we assumed these results. Let us remark that the definition
of the forces relation is, by itself, quite demanding; the
formalization of it and of the fundamental theorems of forcing roughly
comprises little less than a half of our full project.

It might be a little surprising the lack of formalizations of forcing
and generic extensions. As far as we know, the development of
\citet{JFR6232} in homotopy type theory for constructing generic
extensions in a sheaf-theoretic setting is the unique mechanization of
forcing. This contrast with the fruitful use of forcing techniques to
extend the Curry-Howard isomorphism to classical axioms
\cite{Miquel:2011:FPT:2058525.2059614,lmcs:1070}. Moreover, the
combination of forcing with intuitionistic type theory
\cite{Coquand:2009:FTT:1807662.1807665,coquand2010note} gives rise
both to positive results (an algorithm to obtain witnesses of the
continuity of definable functionals \cite{coquand2012computational})
and also negative (the independence of Markov's principle
\cite{lmcs:3859}). In the same strand of forcing from the point of
view of proof theory \cite{avigad_2004} are the conservative
extensions of CoC with forcing conditions
\cite{jaber:hal-01319066,Jaber:2012:ETT:2358958.2359524}.

% \fbox{Parece mucho comienzo sólo para introducir a Kunen}
% \fbox{¿lo puedo achurar un poco?}

% In a gross simplification, there are two aspects to a formalization
% project like this one: thematic and programmatic. The first concerns
% the handling of all the theoretical concepts and results in the
% subject, while the second involves the practical issues of the
% implementation and design. In the case of forcing, the main intricacy
% lies in the first aspect. In this sense, following a sensible
% presentation of the material is key.  The authoritative reference 
% on the subject during the last 30 years has been Kunen's classical
% \cite{kunen1980}. In our
% formalizaton we have followed a recent rewrite \cite{kunen2011set}
% of that  textbook, which presents the material in the same sharp 
% style but offering a lot of details. In some sense this project
% wouldn't exist without this book. As alternative, introductory
% resources, the  interested reader can check
% \cite{chow-beginner-forcing}; also, the book \cite{weaver2014forcing}
% contains a thorough treament minimizing the technicalities.

In pursuing the proof of preservation on generic extensions we
extended Paulson's library with:
\begin{inlinelist}
\item renaming of variables, which with little effort can be extended
  to substitutions;
\item an improvement on definitions by recursion on well-founded
  relations; 
\item a better hierarchy of locales; and
\item a new choice principle and a version of Rassiowa-Sikorski which
  ensure the existence of generic filters for countable and transitive
  models of $\ZF$; these points were already communicated in the
  first report \cite{2018arXiv180705174G}.
\end{inlinelist} 

We briefly describe the contents of each
section. Section~\ref{sec:isabelle} contains the bare minimun
requirements to understand the (meta)logics used in Isabelle. Next, an
overview of the model theory of set theory is presented in
Section~\ref{sec:axioms-models-set-theory}. There is an ``internal''
representation of first-order formulas as sets, implemented by
Paulson; Section~\ref{sec:renaming} discusses syntactical
transformations of the former, mainly permutation of variables. 
In Section~\ref{sec:generic-extensions} the generic extensions are
succintly reviewed and how the treatment of well founded recursion in
Isabelle was enhanced. We take care of the ``easy axioms'' in
Section~\ref{sec:easy-axioms}; these are the ones that
do not depend on the forcing theorems. We describe the latter in
Section~\ref{sec:forcing}. We adapted the  work by Paulson to our
needs, and this is described in
Section~\ref{sec:hack-constructible}. We present the proof
of the Separation Axiom Scheme in Section~\ref{sec:proof-separation},
which follows closely its implementation. A plan for future work and
some immediate conclusions are offered in
Section~\ref{sec:conclusions-future-work}.

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "Separation_In_MG"
%%% ispell-local-dictionary: "american"
%%% End: 
