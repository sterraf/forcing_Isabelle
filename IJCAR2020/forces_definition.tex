\section{The definition of $\forceisa$}
\label{sec:definition-forces}

The core of the development is showing the definability of the
relation of forcing. As explained in
\cite[Sect.~8]{2019arXiv190103313G}, this comprises the 
definition of a function $\forceisa$ that maps the set of internal
formulas into itself. It is the very reason of applicability of
forcing that the satisfaction of the formula $\forceisa(\phi)$ in a
model controls the satisfaction of $\phi$ in all of its generic
extensions.

The definition of $\forceisa$ proceeds by recursion
over the set $\formula$ and its base case, that is, for
atomic formulas, is (in)famously the most complicated one. Actually,
newcomers can be puzzled by the fact that forcing for atomic
formulas is also defined by (mutual) recursion: to know if $\tau_1\in\tau_2$ is
forced by $p$ (notation: $\forcesmem(p,\tau_1,\tau_2)$), one must check if $\tau_1=\sigma$ is forced for $\sigma$
moving in the transitive closure of $\tau_2$. To disentangle this, one
must realize that this last recursion must be described syntactically:
the definition of $\forceisa(\phi)$ for atomic $\phi$ is then an
internal definition of the alleged recursion on names. 

Our aim was to follow Kunen~\cite[p.~257]{kunen2011set}, where the
following mutual recursion is given:
\begin{multline}\label{eq:def-forcing-equality}
  \forceseq (p,t_1,t_2) \defi 
  \forall s\in\dom(t_1)\cup\dom(t_2).\ \forall q\pleq p .\\
  \forcesmem(q,s,t_1)\lsii 
  \forcesmem(q,s,t_2),
\end{multline}
\begin{multline}\label{eq:def-forcing-membership}
  \forcesmem(p,t_1,t_2) \defi  \forall v\pleq p. \ \exists q\pleq v. \\
  \exists s.\ \exists r\in \PP .\ \lb s,r\rb \in
      t_2 \land q \pleq r \land \forceseq(q,t_1,s)
\end{multline}
Note that the definition of $\forcesmem$ states that the set 
\[
\{q\pleq p : \exists \lb s,r\rb\in t_2 . \ q\pleq r \land \forceseq(q,t_1,s)\}
\]
is dense below $p$.

It was not straightforward to use the recursion machinery of
Isabelle/ZF to define $\forceseq$ and $\forcesmem$. For this, we
defined a relation $\frecR$ on 4-tuples of elements of $M$, proved
that it is wellfounded ---indeed, we also proved an
induction principle for this relation:
%
\begin{isabelle}
\isacommand{lemma}\isamarkupfalse%
\ forces{\isacharunderscore}induction{\isacharcolon}\isanewline
\ \ \isakeyword{assumes}\isanewline
\ \ \ \ {\isachardoublequoteopen}{\isasymAnd}{\isasymtau}\ {\isasymtheta}{\isachardot}\ {\isasymlbrakk}{\isasymAnd}{\isasymsigma}{\isachardot}\ {\isasymsigma}{\isasymin}domain{\isacharparenleft}{\isasymtheta}{\isacharparenright}\ {\isasymLongrightarrow}\ Q{\isacharparenleft}{\isasymtau}{\isacharcomma}{\isasymsigma}{\isacharparenright}{\isasymrbrakk}\ {\isasymLongrightarrow}\ R{\isacharparenleft}{\isasymtau}{\isacharcomma}{\isasymtheta}{\isacharparenright}{\isachardoublequoteclose}\footnotemark\isanewline
\ \ \ \ {\isachardoublequoteopen}{\isasymAnd}{\isasymtau}\ {\isasymtheta}{\isachardot}\ {\isasymlbrakk}{\isasymAnd}{\isasymsigma}{\isachardot}\ {\isasymsigma}{\isasymin}domain{\isacharparenleft}{\isasymtau}{\isacharparenright}\ {\isasymunion}\ domain{\isacharparenleft}{\isasymtheta}{\isacharparenright}\ {\isasymLongrightarrow}\ R{\isacharparenleft}{\isasymsigma}{\isacharcomma}{\isasymtau}{\isacharparenright}\ {\isasymand}\ R{\isacharparenleft}{\isasymsigma}{\isacharcomma}{\isasymtheta}{\isacharparenright}{\isasymrbrakk}\isanewline
\ \ \ \ \ \  {\isasymLongrightarrow}\ Q{\isacharparenleft}{\isasymtau}{\isacharcomma}{\isasymtheta}{\isacharparenright}{\isachardoublequoteclose}\isanewline
\ \ \isakeyword{shows}\isanewline
\ \ \ \ {\isachardoublequoteopen}Q{\isacharparenleft}{\isasymtau}{\isacharcomma}{\isasymtheta}{\isacharparenright}\ {\isasymand}\ R{\isacharparenleft}{\isasymtau}{\isacharcomma}{\isasymtheta}{\isacharparenright}{\isachardoublequoteclose}
\end{isabelle}
\footnotetext{The logical primitives of \emph{Pure} are
\isatt{\isasymLongrightarrow}, \isatt{\&\&\&}, and \isatt{\isasymAnd}
(implication, conjunction, and universal
quantification, resp.), which operate on the meta-booleans
\isatt{prop}.}
%
and 
obtained both functions as cases of a another one, 
$\forcesat$, using a single recursion on $\frecR$. Then we obtained 
(\ref{eq:def-forcing-equality}) and (\ref{eq:def-forcing-membership})
as our corollaries \isatt{def{\isacharunderscore}forces{\isacharunderscore}eq} and
\isatt{def{\isacharunderscore}forces{\isacharunderscore}mem}.

Other approaches, like the one in Neeman~\cite{neeman-course} (and
Kunen's older \cite{kunen1980}), prefer
to have a single, more complicated, definition by simple recursion for
$\forceseq$ and then define $\forcesmem$ explicitly. On hindsight,
this might have been a little simpler to do, but we preferred to be as
faithful to the text as possible concerning this point.

Once $\forcesat$ and its relativized version $\isatt{is{\isacharunderscore}forces{\isacharunderscore}at}$
were defined, we proceeded to show absoluteness and provided internal
definitions for the recursion on names using results in
\isatt{ZF-Constructible}. This finished the atomic case of the
formula-transformer $\forceisa$. 

\paragraph*{Technical details}
Paulson proved absoluteness of functions defined by wellfounded
recursion over a transitive relation. Some of our definitions by
recursion (\emph{check} and \emph{forces}) do not fit in that scheme.
One can replace the relation $R$ for its transitive closure $R^+$ in the
recursive definition because one can prove, in general, that
$F\!\upharpoonright\!(R^{-1}(x))(y) =
F\!\upharpoonright\!({R^+}^{-1}(x))(y)$ whenever $(x,y) \in R$.


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "forcing_in_isabelle_zf"
%%% ispell-local-dictionary: "american"
%%% End: 
