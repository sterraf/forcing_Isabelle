\section{Introduction}
\label{sec:introduction}

The present work reports on the third stage of our project of
formalizing the theory of forcing and its applications as presented in
one of the more
important references on the subject, Kunen's Set Theory
\cite{kunen2011set} (a rewrite of the classical \cite{kunen1980}). 

We
work using the  implementation of Zermelo-Fraenkel ($\ZF$)
set theory \emph{Isabelle/ZF} by Paulson and Grabczewski \cite{DBLP:journals/jar/PaulsonG96}. In
an early paper \cite{2018arXiv180705174G}, we set up the first
elements of the countable transitive model (ctm) approach, defining
forcing notions, names, generic extensions, and
showing the existence of generic filters via the Rasiowa-Sikorski
lemma (RSL). Our second (unpublished) technical report
\cite{2019arXiv190103313G} advanced by presenting the first accurate
\emph{formal abstract} of the Fundamental Theorems of Forcing, and
using them to show that that the $\ZF$ axioms apart from Replacement
and Infinity hold in all generic extensions.

This paper contains the proof of Fundamental Theorems and complete
proofs of the Axioms of Infinity, Replacement, and Choice in all
generic extensions. In particular, we were able to fulfill the
promised formal abstract for the Forcing 
Theorems almost to the letter. A requirement for Infinity and the
absoluteness of forcing for atomic formulas, we finished the interface
between our development and
Paulson's constructibility library \cite{paulson_2003} which enables
us to do well-founded
recursion inside transitive models of an appropriate finite fragment
of $\ZF$. As a by-product, we honored a long debt: the fact that the
generic filter $G$ belongs to the extension $M[G]$ and 
$M\sbq M[G]$. We also include an example of forcing notion for which
the last inclusion is proper.
Finally, our development is now independent of $\AC$: We modularized
RSL in such a way that a version for countable 
posets does not require choice.

In the course of our work we found it useful to develop Isar methods to
automate repetitive tasks. Part of the interface with Paulson's
library consisted in constructing formulas for each relativized
concept; and actually Isabelle's Simplifier can
synthesize terms for unbound schematic variables in theorems. The
synthesized term, however, is not available outside the theorem; we
introduced a method that creates a definition from a schematic
goal. The second method is concerned with renaming of formulas: we
improved our small library of bounded renamings with a method that
given the source and target environments figures out the renaming
function and produces the relevant lemmas about it.

\begin{framed}
  TODO: Comentar en algún lado las limitaciones del método de
  definiciones sintetizadas.

  TODO: Explicar mejor que las fórmulas que necesitamos definir son un
  ejemplo exacto de lo que se puede hacer con schematic\_goal.
\end{framed}

\subsection{Related work}
To the best of our knowledge, all of the previous works in
formalization of the method 
of forcing have been done in different variants of type theory, and
none of them uses the ctm approach. The
most important is the recent one by 
Han and van Doorn
\cite{han_et_al:LIPIcs:2019:11074,DBLP:conf/cpp/HanD20}, which includes
a formalization of the independence of $\CH$ by means
the Boolean-valued approach to forcing, using the Lean
proof assistant \cite{DBLP:conf/cade/MouraKADR15}.

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "forcing_in_isabelle_zf"
%%% ispell-local-dictionary: "american"
%%% End: 
